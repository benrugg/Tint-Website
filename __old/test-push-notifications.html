<!DOCTYPE html>
<head>
  <title>Pusher Test</title>
  <script src="http://js.pusher.com/1.12/pusher.min.js" type="text/javascript"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
  <script type="text/javascript">
	
	// Enable pusher logging - xxx don't include this in production
	Pusher.log = function(message) {
	  if (window.console && window.console.log) window.console.log(message);
	};
	
	
	/*
	// Tell pusher where to find our authentication file (needed so our app can send "client" events)
	Pusher.channel_auth_endpoint = '/pusher-auth.php';
	
	
	// Flash fallback logging - xxx don't include this in production
	WEB_SOCKET_DEBUG = true;

	var pusher = new Pusher('abbed27716bfdc0b8829');
	var channel = pusher.subscribe('private-test');
	var connected = false;
	
	channel.bind('pusher:subscription_succeeded', function() {
		
		connected = true;
	});
	
	channel.bind('client-test', function(data) {
		
		alert(data);
	});
	
	
	
	function sendMessage() {
		
		if (!connected) {
			
			alert("sorry, we're not connected");
			
		} else {
			
		 	channel.trigger("client-test", "test again");
		}
	}
	*/
	
	
	// Flash fallback logging - don't include this in production
	//WEB_SOCKET_DEBUG = true;

	var pusher = new Pusher('abbed27716bfdc0b8829');
	var channel = pusher.subscribe('main');
	var connected = false;
	
	channel.bind('pusher:subscription_succeeded', function() {
		
		connected = true;
	});
	
	channel.bind('new_colors', function(data) {
		alert(data);
	});
	
	
	function sendMessage() {
		
		if (!connected) {
			
			console.log("sorry, we're not connected");
			
		} else {
			
			var colors = {colors: "#FF0000,#FF3300,#FF6633", socketID: pusher.connection.socket_id};
			
			
			$.ajax({
				url: "/ajax/send-colors.php",
				data: colors,
				dataType: "json"
			}).done(function(response) {
				
				var status = (response && response.status) ? response.status : "no status";
				
				console.log("colors sent. response: " + status);
				
			}).fail(function() {
				
				console.log("error. ajax failure when sending colors");
			});
		}
	}
	
  </script>
</head>
<body>

<button onclick="javascript:sendMessage()">Send Message</button>

</body>
</html>